<sidebar flex="20"></sidebar>

<section class="main-section" flex="40">
    <md-button class="md-accent md-fab add-link-button" aria-label="Add Links" ng-click="ctrl.openAddLinkModal()">
        <md-icon md-svg-icon="plus"></md-icon>
    </md-button>
    <div class="text-center">
        <img src="/assets/images/main-logo.png" alt="">
        <p class="md-body-1 tagline">Hand picked rating and curating - by the people for the people.</p>
        <form ng-submit="ctrl.search()">
            <md-input-container>
                <input type="search" ng-model="ctrl.searchQuery" placeholder="Search Tags/Links" />
            </md-input-container>
            <md-button><md-icon md-svg-icon="magnifying-glass"></md-icon></md-button>
        </form>
    </div>

    <div ng-if="ctrl.tagsSearchResults.length">
      <ul>
        <!-- remove ng click once tag tooltip works -->
        <li ng-repeat="tag in ctrl.tagsSearchResults" ng-click="ctrl.setTagAsSearchQuery(tag.name)">
          {{ tag.linksCount }}
          {{ tag.name }}
        </li>
      </ul>
    </div>

    <div ng-if="ctrl.linksSearchResults.length">
      <ul class="links-list">
        <li ng-repeat="link in ctrl.linksSearchResults">
            <md-card>
                <h3 class="link-title">{{ link.title }}</h3>
                <div class="link-meta" layout layout-align="space-between">
                    <a class="link-url" ng-href="{{ link.url }}" target="_blank">{{ link.url }}</a>

                    <star-rating readonly="link.currentUserEvaluation"
                                 ng-model="link.currentUserEvaluation"
                                 on-rating-select="ctrl.rateLink(link)"></star-rating>
                </div>

                <ul>
                  <li ng-repeat="tag in link.tags">
                    <span class="tag-endoresements">{{ tag.endorsmentCount }}</span>
                    <md-icon md-svg-icon="thumbs-up"></md-icon>
                    <span class="vertical-separator"></span>
                    <span class="tag-name" ng-click="ctrl.setTagAsSearchQuery(tag.name)">{{ tag.name }}</span>
                    
                    <div class="tag-buttons">
                        <md-button class="md-fab md-raised md-mini" ng-click="ctrl.endorseTag(link.id, tag.contributionId)"><md-icon md-svg-icon="thumbs-up"></md-icon></md-button>
                        <md-button class="md-fab md-raised md-mini" ng-click="ctrl.DEendorseTag(link.id, tag.contributionId)"><md-icon md-svg-icon="thumbs-down"></md-icon></md-button>
                        <md-button class="md-fab md-raised md-mini" ng-click="ctrl.setTagAsSearchQuery(tag.name)"><md-icon md-svg-icon="magnifying-glass"></md-icon></md-button>
                    </div>
                  </li>
                </ul>

                <div class="new-link-tags">
                  <form ng-submit="ctrl.addTagToLink($select.selected, link.id)">
                    <ui-select reset-search-input="true"
                               ng-model="newTag"
                               on-select="ctrl.addTagToLink($select.selected, link.id)">

                      <ui-select-match placeholder="Add tag">{{ $item.name }}</ui-select-match>

                      <ui-select-choices repeat="tag in ctrl.tagsToSelectFrom"
                                         refresh="ctrl.refreshTagsToSelectFrom($select.search, link.tags)"
                                         refresh-delay="50">

                        <div class='select-contributor flex'>
                          <div>{{ tag.name }}</div>
                        </div>

                      </ui-select-choices>
                    </ui-select>
                  </form>
                </div>

            </md-card>
        </li>
      </ul>
    </div>

</section>